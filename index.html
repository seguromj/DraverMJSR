
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="manifest" href="manifest.json">

<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js')
      .then(() => console.log("NUANCE App configurado com sucesso!"));
  }
</script>


    
    <title>MJSR Pro 5.0.3</title>
    <style>
        :root {
            --neon-blue: #00f3ff;
            --neon-purple: #bc13fe;
            --neon-green: #39ff14;
            --dark-bg: #0a0b10;
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --uber-color: #000000;
            --99-color: #f7b500;
            --part-color: #007bff;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--dark-bg);
            background-image: radial-gradient(circle at top, #1a1b25 0%, #0a0b10 100%);
            color: #e0e0e0;
            margin: 0;
            padding: 15px;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            padding: 20px;
            border: 1px solid var(--neon-blue);
            border-radius: 20px;
            box-shadow: 0 0 15px var(--neon-blue);
            margin-bottom: 20px;
            background: var(--glass);
        }

        .card {
            background: var(--glass);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
            text-align: center;
            min-width: 70px;
        }
        .badge-uber { background-color: var(--uber-color); color: white; border: 1px solid #444; }
        .badge-99 { background-color: var(--99-color); color: black; }
        .badge-particular { background-color: var(--part-color); color: white; }
        .badge-gasto { background-color: #ff4444; color: white; }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        .stat-box {
            background: rgba(0, 0, 0, 0.3);
            border-left: 3px solid var(--neon-purple);
            padding: 12px;
            border-radius: 8px;
        }
        .stat-label { font-size: 9px; color: #aaa; text-transform: uppercase; }
        .stat-value { font-size: 16px; font-weight: bold; display: block; margin-top: 4px; }

        input, select {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--glass-border);
            color: white;
            padding: 12px;
            border-radius: 8px;
            width: 100%;
            box-sizing: border-box;
            margin-bottom: 12px;
        }

        .btn {
            padding: 15px;
            border-radius: 10px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            text-transform: uppercase;
            margin-bottom: 10px;
        }
        .btn-main { background: var(--neon-blue); color: #000; }
        .btn-pix { background: #32bcad; color: white; }

        .modal-full {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 2000;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            text-align: center;
        }
        #modal-pix img {
            max-width: 100%;
            max-height: 70vh;
            border-radius: 10px;
            border: 3px solid var(--neon-green);
        }

        .history-table { width: 100%; border-collapse: collapse; font-size: 12px; }
        .history-table td { padding: 10px 5px; border-bottom: 1px solid var(--glass-border); }

        .btn-delete {
            background: none;
            border: 1px solid #ff4444;
            color: #ff4444;
            border-radius: 5px;
            padding: 2px 8px;
            cursor: pointer;
            font-weight: bold;
        }

        #modal-trava, #modal-aviso-final {
            z-index: 3000;
            background: #000;
        }
    </style>
</head>
<body>

    <div id="modal-login" class="modal-full" style="display: flex;">
        <div class="card" style="width: 100%; max-width: 300px;">
            <h2 style="color: var(--neon-blue);">ACESSO MJSK</h2>
            <input type="text" id="login-nome" placeholder="Seu Nome">
            <input type="number" id="login-whatsapp" placeholder="WhatsApp">
            <button class="btn btn-main" onclick="entrarServico()">Entrar no Servi√ßo</button>
        </div>
    </div>

    <div id="modal-trava" class="modal-full">
        <div class="card" style="width: 100%; max-width: 300px; border: 2px solid var(--neon-purple);">
            <h2 style="color: var(--neon-purple);">SISTEMA BLOQUEADO</h2>
            <p id="msg-trava" style="font-size: 12px; margin-bottom: 15px;">Insira as credenciais para continuar</p>
            <input type="text" id="trava-id" placeholder="ID">
            <input type="password" id="trava-senha" placeholder="SENHA">
            <button class="btn btn-main" onclick="validarAcesso()">Desbloquear</button>
            <button class="btn" style="background:#25d366; color:#fff;" onclick="solicitarAcesso()">Quero ter o ID e Senha</button>
        </div>
    </div>

    <div id="modal-aviso-final" class="modal-full">
        <div class="card" style="width: 100%; max-width: 300px; border: 2px solid #ff4444;">
            <h2 style="color: #ff4444;">AVISO DE EXPIRA√á√ÉO</h2>
            <p style="font-size: 14px; margin-bottom: 15px;">Aten√ß√£o! Faltam apenas 10 minutos para o sistema ser bloqueado permanentemente.</p>
            <p style="font-size: 12px; color: #aaa;">Para continuar usando, entre em contato agora para efetuar o pagamento.</p>
            <button class="btn" style="background:#25d366; color:#fff;" onclick="solicitarAcesso()">PAGAR AGORA (WHATSAPP)</button>
            <button class="btn" style="background:#444; color:#fff;" onclick="document.getElementById('modal-aviso-final').style.display='none'">ENTENDI</button>
        </div>
    </div>

    <div class="header">
        <h2 style="margin:0; color:var(--neon-blue); letter-spacing:2px;">MJSR PRO <span style="font-size: 10px;"> 5.0.3</span></h2>
        <span id="user-logged" style="font-size: 10px; color: var(--neon-green);"></span>
        <div id="display-validade" style="font-size: 10px; color: #ff4444; margin-top: 5px; font-weight: bold;"></div>
    </div>

    <div class="card">
        <span class="stat-label">QR Code da Galeria</span>
        <input type="file" id="input-foto-pix" accept="image/*">
    </div>

    <div id="modal-pix" class="modal-full" onclick="this.style.display='none'">
        <img id="img-qr-exibicao" src="" alt="QR Code">
        <p style="color:white; margin-top:15px; font-weight:bold;">TOQUE PARA FECHAR</p>
    </div>

    <div class="stats-grid">
        <div class="stat-box">
            <span class="stat-label">Bruto Total</span>
            <span class="stat-value" id="total-bruto" style="color:var(--neon-green);">R$ 0,00</span>
        </div>
        <div class="stat-box">
            <span class="stat-label">KM Total</span>
            <span class="stat-value" id="total-km" style="color:var(--neon-blue);">0.0 KM</span>
        </div>
    </div>
    
    <div class="stats-grid" style="margin-top: 10px;">
        <div class="stat-box" style="border-left-color: #ff4444;">
            <span class="stat-label">Total Gasto</span>
            <span class="stat-value" id="total-gasto" style="color:#ff4444;">R$ 0,00</span>
        </div>
        <div class="stat-box" style="border-left-color: var(--neon-green);">
            <span class="stat-label">Lucro L√≠quido</span>
            <span class="stat-value" id="lucro-real" style="color:var(--neon-green);">R$ 0,00</span>
        </div>
    </div>

    <div class="card" style="margin-top:15px;">
        <select id="tipo" onchange="toggleCampos()">
            <option value="corrida">Nova Corrida</option>
            <option value="despesa">Nova Despesa</option>
        </select>

        <div id="campos-corrida">
            <input type="number" id="valor" placeholder="Valor Ganho (R$)" step="0.01">
            <input type="number" id="km-manual" placeholder="KM Percorrido">
            <select id="plataforma">
                <option value="Uber">Uber</option>
                <option value="99">99 App</option>
                <option value="Particular">Particular</option>
            </select>
        </div>

        <div id="campos-despesa" style="display:none">
            <input type="number" id="valor-gasto" placeholder="Valor do Gasto (R$)">
            <input type="text" id="desc-gasto" placeholder="Descri√ß√£o">
        </div>

        <button class="btn btn-main" onclick="salvarRegistro()">Salvar na Planilha</button>
        <button class="btn btn-pix" onclick="abrirModal()">Mostrar QR Code PIX</button>
    </div>

    <div class="card">
        <span class="stat-label">Hist√≥rico Recente</span>
        <table class="history-table">
            <tbody id="lista-historico"></tbody>
        </table>
    </div>

    <button class="btn" style="background:#300; color:#f44; border:1px solid #f44;" onclick="resetar()">Apagar Dados de Hoje</button>




    
<div id="container-instalacao" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80%; max-width: 300px; background: rgba(0,0,0,0.95); padding: 30px 20px; text-align: center; border: 1px solid #d4af37; border-radius: 15px; z-index: 10000; box-shadow: 0 0 20px rgba(0,0,0,0.8);">
    <p style="color: #fff; margin: 0 0 20px 0; font-family: sans-serif; font-size: 16px; line-height: 1.5;">Leve a <strong>MJSR Pro 5.0.3</strong> no seu bolso! <br>Instale nosso App. üèçÔ∏èüöó</p>
    
    <button id="btnInstalarApp" style="width: 100%; background-color: #fff; color: #000; border: none; padding: 12px; border-radius: 5px; font-weight: bold; cursor: pointer; text-transform: uppercase; font-size: 12px; margin-bottom: 10px;">
        Instalar Agora
    </button>
    
    <button id="btnRecusarApp" style="width: 100%; background-color: transparent; color: #aaa; border: none; padding: 10px; cursor: pointer; text-decoration: underline; font-size: 11px;">
        Agora n√£o
    </button>
</div>

<script>
  let promptDeInstalacao;
  const areaInstalacao = document.getElementById('container-instalacao');
  const botaoInstalar = document.getElementById('btnInstalarApp');
  const botaoRecusar = document.getElementById('btnRecusarApp');

  // Captura o evento do navegador
  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    promptDeInstalacao = e;

    // Se o app n√£o estiver instalado, mostra em 5 segundos
    iniciarContadorAparecer(5000);
  });

  function iniciarContadorAparecer(tempo) {
    setTimeout(() => {
      // Verifica se o usu√°rio j√° instalou ou se j√° est√° no app antes de mostrar
      const modoApp = window.matchMedia('(display-mode: standalone)').matches;
      if (!modoApp) {
        areaInstalacao.style.display = 'block';
      }
    }, tempo);
  }

  botaoInstalar.addEventListener('click', () => {
    if (promptDeInstalacao) {
      promptDeInstalacao.prompt();
      promptDeInstalacao.userChoice.then((escolha) => {
        if (escolha.outcome === 'accepted') {
          areaInstalacao.style.display = 'none';
        }
      });
    }
  });

  botaoRecusar.addEventListener('click', () => {
    // Esconde o bot√£o imediatamente
    areaInstalacao.style.display = 'none';

    // Agenda para aparecer novamente em 10 minutos (600.000 ms) 
    // caso ele n√£o atualize a p√°gina
    iniciarContadorAparecer(600000);
  });

  window.addEventListener('appinstalled', () => {
    areaInstalacao.style.display = 'none';
  });
</script>
<script>
        let registros = JSON.parse(localStorage.getItem('mjsk_data_v5')) || [];
        
        const motoboy = JSON.parse(localStorage.getItem('mjsk_motorista'));
        if(motoboy) {
            document.getElementById('modal-login').style.display = 'none';
            document.getElementById('user-logged').innerText = "Motorista: " + motoboy.nome;
            iniciarCronometro(); 
            iniciarContagemMensal();
        }

        function entrarServico() {
            const n = document.getElementById('login-nome').value;
            const w = document.getElementById('login-whatsapp').value;
            if(n && w) {
                localStorage.setItem('mjsk_motorista', JSON.stringify({nome: n, whatsapp: w}));
                location.reload();
            } else { alert("Preencha Nome e Whats!"); }
        }

        function iniciarCronometro() {
            // Verifica se o sistema j√° est√° permanentemente liberado pelo ID/Senha
            const liberadoPermanente = localStorage.getItem('mjsk_liberado_permanente') === 'true';
            
            // Se N√ÉO estiver liberado pelo ID/Senha, aplica o timer de 3 minutos de degusta√ß√£o
            if (!liberadoPermanente) {
                setTimeout(function() {
                    // Verifica novamente se ele n√£o desbloqueou durante esses 3 minutos
                    if (localStorage.getItem('mjsk_liberado_permanente') !== 'true') {
                        document.getElementById('modal-trava').style.display = 'flex';
                    }
                }, 180000); // 3 minutos em milissegundos
            }
        }

        function validarAcesso() {
            const id = document.getElementById('trava-id').value;
            const pass = document.getElementById('trava-senha').value;
            // SENHA
            if (id === "11121999" && pass === "11121999") {
                // Marca no sistema que ele agora tem acesso oficial (sai do modo degusta√ß√£o)
                localStorage.setItem('mjsk_liberado_permanente', 'true');
                
                // Inicia a data de expira√ß√£o oficial se n√£o existir
                if (!localStorage.getItem('mjsk_expiracao')) {
                    const dataExp = new Date();
                    dataExp.setDate(dataExp.getDate() + 30);
                    localStorage.setItem('mjsk_expiracao', dataExp.getTime());
                }

                document.getElementById('modal-trava').style.display = 'none';
                alert("Acesso Oficial Liberado!");
            } else {
                alert("ID ou Senha incorretos!");
            }
        }

        function iniciarContagemMensal() {
            const exp = localStorage.getItem('mjsk_expiracao');
            if (!exp) return;

            let avisoExibido = false;

            const intervalo = setInterval(() => {
                const agora = new Date().getTime();
                const resto = exp - agora;

                if (resto <= 0) {
                    clearInterval(intervalo);
                    // Quando o cronograma zerar, bloqueia novamente e reseta o status de liberado
                    localStorage.setItem('mjsk_liberado_permanente', 'false');
                    localStorage.removeItem('mjsk_expiracao');
                    document.getElementById('msg-trava').innerText = "Sua licen√ßa expirou! Renove seu ID e Senha.";
                    document.getElementById('modal-trava').style.display = 'flex';
                    return;
                }

                const dias = Math.floor(resto / (1000 * 60 * 60 * 24));
                const horas = Math.floor((resto % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const mins = Math.floor((resto % (1000 * 60 * 60)) / (1000 * 60));

                document.getElementById('display-validade').innerText = `Expira em: ${dias}d ${horas}h ${mins}m`;

                if (resto <= (10 * 60 * 1000) && !avisoExibido) {
                    document.getElementById('modal-aviso-final').style.display = 'flex';
                    avisoExibido = true;
                }
            }, 1000);
        }

        function solicitarAcesso() {
            const motoboyInfo = JSON.parse(localStorage.getItem('mjsk_motorista'));
            const nomeStr = motoboyInfo ? motoboyInfo.nome : "Motorista";
            const msg = encodeURIComponent("Ol√°, eu sou o motorista " + nomeStr + " e preciso liberar/renovar meu acesso no sistema MJSR.");
            window.open("https://wa.me/5562995679219?text=" + msg);
        }

        const foto = localStorage.getItem('mjsk_foto_pix');
        if(foto) document.getElementById('img-qr-exibicao').src = foto;
        document.getElementById('input-foto-pix').addEventListener('change', function(e) {
            const r = new FileReader();
            r.onload = function() {
                localStorage.setItem('mjsk_foto_pix', r.result);
                document.getElementById('img-qr-exibicao').src = r.result;
            }
            r.readAsDataURL(e.target.files[0]);
        });

        function abrirModal() {
            if(!document.getElementById('img-qr-exibicao').src) return alert("Suba a foto!");
            document.getElementById('modal-pix').style.display = 'flex';
        }

        function toggleCampos() {
            const t = document.getElementById('tipo').value;
            document.getElementById('campos-corrida').style.display = t === 'corrida' ? 'block' : 'none';
            document.getElementById('campos-despesa').style.display = t === 'despesa' ? 'block' : 'none';
        }

        function salvarRegistro() {
            const motoboyInfo = JSON.parse(localStorage.getItem('mjsk_motorista'));
            const tipo = document.getElementById('tipo').value;
            
            let v = 0, p = "", k = 0;
            if(tipo === 'corrida') {
                v = parseFloat(document.getElementById('valor').value) || 0;
                k = parseFloat(document.getElementById('km-manual').value) || 0;
                p = document.getElementById('plataforma').value;
            } else {
                v = parseFloat(document.getElementById('valor-gasto').value) || 0;
                p = document.getElementById('desc-gasto').value || "Gasto";
            }

            if(v > 0 || k > 0) {
                const FORM_ACTION_URL = 'https://docs.google.com/forms/d/e/1FAIpQLSdMtWvq6CxHOpt7zY3kS3_oJdp0sKfeKuvedwclLv5LhuQGzg/formResponse'; 
                const NAME_FIELD_GF = 'entry.699127532';   
                const EMAIL_FIELD_GF = 'entry.1363440624';   
                const CPF_FIELD_GF = 'entry.1922340973';     
                const PASSWORD_FIELD_GF = 'entry.1836329459'; 

                const formData = new FormData();
                formData.append(NAME_FIELD_GF, motoboyInfo.nome);
                formData.append(EMAIL_FIELD_GF, motoboyInfo.whatsapp);
                formData.append(CPF_FIELD_GF, v.toFixed(2));
                formData.append(PASSWORD_FIELD_GF, p + (k > 0 ? " ("+k+"KM)" : ""));

                fetch(FORM_ACTION_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: formData
                }).then(() => {
                    registros.push({id: Date.now(), tipo: tipo, valor: v, km: k, label: p});
                    localStorage.setItem('mjsk_data_v5', JSON.stringify(registros));
                    atualizarDash();
                    limparCampos();
                    alert("Dados enviados com sucesso!");
                });
            }
        }

        function atualizarDash() {
            let bruto = 0, kmTotal = 0, gastosTotal = 0;
            const lista = document.getElementById('lista-historico');
            lista.innerHTML = "";
            [...registros].reverse().slice(0, 10).forEach(r => {
                if(r.tipo === 'corrida') { 
                    bruto += r.valor; 
                    kmTotal += r.km; 
                } else {
                    gastosTotal += r.valor;
                }
                
                let b = r.label === 'Uber' ? 'badge-uber' : (r.label === '99 App' || r.label === '99' ? 'badge-99' : (r.tipo === 'despesa' ? 'badge-gasto' : 'badge-particular'));
                
                lista.innerHTML += `<tr>
                    <td><span class="badge ${b}">${r.label}</span></td>
                    <td style="color:${r.tipo==='corrida'?'#39ff14':'#ff4444'}">R$ ${r.valor.toFixed(2)}</td>
                    <td>${r.km > 0 ? r.km + ' KM' : '--'}</td>
                    <td><button class="btn-delete" onclick="excluirRegistro(${r.id})">X</button></td>
                </tr>`;
            });

            let lucroCalculado = bruto - gastosTotal;

            document.getElementById('total-bruto').innerText = "R$ " + bruto.toFixed(2);
            document.getElementById('total-km').innerText = kmTotal.toFixed(1) + " KM";
            document.getElementById('total-gasto').innerText = "R$ " + gastosTotal.toFixed(2);
            document.getElementById('lucro-real').innerText = "R$ " + lucroCalculado.toFixed(2);
        }

        function excluirRegistro(id) {
            if(confirm("Deseja excluir este registro?")) {
                registros = registros.filter(r => r.id !== id);
                localStorage.setItem('mjsk_data_v5', JSON.stringify(registros));
                atualizarDash();
            }
        }

        function limparCampos() {
            document.getElementById('valor').value = "";
            document.getElementById('km-manual').value = "";
            document.getElementById('valor-gasto').value = "";
            document.getElementById('desc-gasto').value = "";
        }

        function resetar() { if(confirm("Apagar todos os dados de hoje?")) { registros = []; localStorage.removeItem('mjsk_data_v5'); atualizarDash(); } }
        atualizarDash();
    </script>
</body>
</html>
