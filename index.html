
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MJSR Pro 5.0.3</title>
    <style>
        :root {
            --neon-blue: #00f3ff;
            --neon-purple: #bc13fe;
            --neon-green: #39ff14;
            --dark-bg: #0a0b10;
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --uber-color: #000000;
            --99-color: #f7b500;
            --part-color: #007bff;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--dark-bg);
            background-image: radial-gradient(circle at top, #1a1b25 0%, #0a0b10 100%);
            color: #e0e0e0;
            margin: 0;
            padding: 15px;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            padding: 20px;
            border: 1px solid var(--neon-blue);
            border-radius: 20px;
            box-shadow: 0 0 15px var(--neon-blue);
            margin-bottom: 20px;
            background: var(--glass);
        }

        .card {
            background: var(--glass);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
            text-align: center;
            min-width: 70px;
        }
        .badge-uber { background-color: var(--uber-color); color: white; border: 1px solid #444; }
        .badge-99 { background-color: var(--99-color); color: black; }
        .badge-particular { background-color: var(--part-color); color: white; }
        .badge-gasto { background-color: #ff4444; color: white; }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        .stat-box {
            background: rgba(0, 0, 0, 0.3);
            border-left: 3px solid var(--neon-purple);
            padding: 12px;
            border-radius: 8px;
        }
        .stat-label { font-size: 9px; color: #aaa; text-transform: uppercase; }
        .stat-value { font-size: 16px; font-weight: bold; display: block; margin-top: 4px; }

        input, select {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--glass-border);
            color: white;
            padding: 12px;
            border-radius: 8px;
            width: 100%;
            box-sizing: border-box;
            margin-bottom: 12px;
        }

        .btn {
            padding: 15px;
            border-radius: 10px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            text-transform: uppercase;
            margin-bottom: 10px;
        }
        .btn-main { background: var(--neon-blue); color: #000; }
        .btn-pix { background: #32bcad; color: white; }

        .modal-full {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 2000;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            text-align: center;
        }
        #modal-pix img {
            max-width: 100%;
            max-height: 70vh;
            border-radius: 10px;
            border: 3px solid var(--neon-green);
        }

        .history-table { width: 100%; border-collapse: collapse; font-size: 12px; }
        .history-table td { padding: 10px 5px; border-bottom: 1px solid var(--glass-border); }

        /* Estilo para o bot√£o de excluir */
        .btn-delete {
            background: none;
            border: 1px solid #ff4444;
            color: #ff4444;
            border-radius: 5px;
            padding: 2px 8px;
            cursor: pointer;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div id="modal-login" class="modal-full" style="display: flex;">
        <div class="card" style="width: 100%; max-width: 300px;">
            <h2 style="color: var(--neon-blue);">ACESSO MJSK</h2>
            <input type="text" id="login-nome" placeholder="Seu Nome">
            <input type="number" id="login-whatsapp" placeholder="WhatsApp">
            <button class="btn btn-main" onclick="entrarServico()">Entrar no Servi√ßo</button>
        </div>
    </div>

    <div class="header">
        <h2 style="margin:0; color:var(--neon-blue); letter-spacing:2px;">MJSR PRO <span style="font-size: 10px;"> 5.0.3</span></h2>
        <span id="user-logged" style="font-size: 10px; color: var(--neon-green);"></span>
    </div>

    <div class="card">
        <span class="stat-label">QR Code da Galeria</span>
        <input type="file" id="input-foto-pix" accept="image/*">
    </div>

    <div id="modal-pix" class="modal-full" onclick="this.style.display='none'">
        <img id="img-qr-exibicao" src="" alt="QR Code">
        <p style="background-color: red; color:white; margin-top:15px; font-weight:bold; padding: 10px; border-radius: 20px;">TOQUE PARA FECHAR</p>
    </div>

    <div class="stats-grid">
        <div class="stat-box">
            <span class="stat-label">Bruto Total</span>
            <span class="stat-value" id="total-bruto" style="color:var(--neon-green);">R$ 0,00</span>
        </div>
        <div class="stat-box">
            <span class="stat-label">KM Total</span>
            <span class="stat-value" id="total-km" style="color:var(--neon-blue);">0.0 KM</span>
        </div>
    </div>

    <div class="card" style="margin-top:15px;">
        <select id="tipo" onchange="toggleCampos()">
            <option value="corrida">Nova Corrida</option>
            <option value="despesa">Nova Despesa</option>
        </select>

        <div id="campos-corrida">
            <input type="number" id="valor" placeholder="Valor Ganho (R$)" step="0.01">
            <input type="number" id="km-manual" placeholder="KM Percorrido">
            <select id="plataforma">
                <option value="Uber">Uber</option>
                <option value="99">99 App</option>
                <option value="Particular">Particular</option>
            </select>
        </div>

        <div id="campos-despesa" style="display:none">
            <input type="number" id="valor-gasto" placeholder="Valor do Gasto (R$)">
            <input type="text" id="desc-gasto" placeholder="Descri√ß√£o">
        </div>

        <button class="btn btn-main" onclick="salvarRegistro()">Salvar na Planilha</button>
        <button class="btn btn-pix" onclick="abrirModal()">Mostrar QR Code PIX</button>
    </div>

    <div class="card">
        <span class="stat-label">Hist√≥rico Recente</span>
        <table class="history-table">
            <tbody id="lista-historico"></tbody>
        </table>
    </div>

    <button class="btn" style="background:#300; color:#f44; border:1px solid #f44;" onclick="resetar()">Apagar Dados de Hoje</button>

    <script>
        let registros = JSON.parse(localStorage.getItem('mjsk_data_v5')) || [];
        
        const motoboy = JSON.parse(localStorage.getItem('mjsk_motorista'));
        if(motoboy) {
            document.getElementById('modal-login').style.display = 'none';
            document.getElementById('user-logged').innerText = "Motorista: " + motoboy.nome;
        }

        function entrarServico() {
            const n = document.getElementById('login-nome').value;
            const w = document.getElementById('login-whatsapp').value;
            if(n && w) {
                localStorage.setItem('mjsk_motorista', JSON.stringify({nome: n, whatsapp: w}));
                location.reload();
            } else { alert("Preencha Nome e Whats!"); }
        }

        // Sistema de Foto
        const foto = localStorage.getItem('mjsk_foto_pix');
        if(foto) document.getElementById('img-qr-exibicao').src = foto;
        document.getElementById('input-foto-pix').addEventListener('change', function(e) {
            const r = new FileReader();
            r.onload = function() {
                localStorage.setItem('mjsk_foto_pix', r.result);
                document.getElementById('img-qr-exibicao').src = r.result;
            }
            r.readAsDataURL(e.target.files[0]);
        });

        function abrirModal() {
            if(!document.getElementById('img-qr-exibicao').src) return alert("Suba a foto!");
            document.getElementById('modal-pix').style.display = 'flex';
        }

        function toggleCampos() {
            const t = document.getElementById('tipo').value;
            document.getElementById('campos-corrida').style.display = t === 'corrida' ? 'block' : 'none';
            document.getElementById('campos-despesa').style.display = t === 'despesa' ? 'block' : 'none';
        }

        function salvarRegistro() {
            const motoboyInfo = JSON.parse(localStorage.getItem('mjsk_motorista'));
            const tipo = document.getElementById('tipo').value;
            
            let v = 0, p = "", k = 0;
            if(tipo === 'corrida') {
                v = parseFloat(document.getElementById('valor').value) || 0;
                k = parseFloat(document.getElementById('km-manual').value) || 0;
                p = document.getElementById('plataforma').value;
            } else {
                v = parseFloat(document.getElementById('valor-gasto').value) || 0;
                p = document.getElementById('desc-gasto').value || "Gasto";
            }

            if(v > 0 || k > 0) {
                // =======================================================================================
                // üö® CONFIGURA√á√ÉO OBRIGAT√ìRIA DO GOOGLE FORMS 
                // =======================================================================================
                const FORM_ACTION_URL = 'https://docs.google.com/forms/d/e/1FAIpQLSdMtWvq6CxHOpt7zY3kS3_oJdp0sKfeKuvedwclLv5LhuQGzg/formResponse'; 
                const NAME_FIELD_GF = 'entry.699127532';   // Nome do Motoboy
                const EMAIL_FIELD_GF = 'entry.1363440624';   // WhatsApp do Motoboy
                const CPF_FIELD_GF = 'entry.1922340973';     // Valor da Corrida/Gasto
                const PASSWORD_FIELD_GF = 'entry.1836329459'; // App/Plataforma Utilizada
                // =======================================================================================

                const formData = new FormData();
                formData.append(NAME_FIELD_GF, motoboyInfo.nome);
                formData.append(EMAIL_FIELD_GF, motoboyInfo.whatsapp);
                formData.append(CPF_FIELD_GF, v.toFixed(2));
                formData.append(PASSWORD_FIELD_GF, p + (k > 0 ? " ("+k+"KM)" : ""));

                fetch(FORM_ACTION_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: formData
                }).then(() => {
                    registros.push({id: Date.now(), tipo: tipo, valor: v, km: k, label: p});
                    localStorage.setItem('mjsk_data_v5', JSON.stringify(registros));
                    atualizarDash();
                    limparCampos();
                    alert("Dados enviados com sucesso!");
                });
            }
        }

        function atualizarDash() {
            let bruto = 0, kmTotal = 0;
            const lista = document.getElementById('lista-historico');
            lista.innerHTML = "";
            [...registros].reverse().slice(0, 10).forEach(r => {
                if(r.tipo === 'corrida') { bruto += r.valor; kmTotal += r.km; }
                let b = r.label === 'Uber' ? 'badge-uber' : (r.label === '99 App' || r.label === '99' ? 'badge-99' : (r.tipo === 'despesa' ? 'badge-gasto' : 'badge-particular'));
                
                // Adicionado bot√£o de excluir (X) na linha da tabela
                lista.innerHTML += `<tr>
                    <td><span class="badge ${b}">${r.label}</span></td>
                    <td style="color:${r.tipo==='corrida'?'#39ff14':'#ff4444'}">R$ ${r.valor.toFixed(2)}</td>
                    <td>${r.km > 0 ? r.km + ' KM' : '--'}</td>
                    <td><button class="btn-delete" onclick="excluirRegistro(${r.id})">X</button></td>
                </tr>`;
            });
            document.getElementById('total-bruto').innerText = "R$ " + bruto.toFixed(2);
            document.getElementById('total-km').innerText = kmTotal.toFixed(1) + " KM";
        }

        // Nova fun√ß√£o para excluir apenas um item do hist√≥rico
        function excluirRegistro(id) {
            if(confirm("Deseja excluir este registro?")) {
                registros = registros.filter(r => r.id !== id);
                localStorage.setItem('mjsk_data_v5', JSON.stringify(registros));
                atualizarDash();
            }
        }

        function limparCampos() {
            document.getElementById('valor').value = "";
            document.getElementById('km-manual').value = "";
            document.getElementById('valor-gasto').value = "";
            document.getElementById('desc-gasto').value = "";
        }

        function resetar() { if(confirm("Apagar todos os dados de hoje?")) { registros = []; localStorage.removeItem('mjsk_data_v5'); atualizarDash(); } }
        atualizarDash();
    </script>
</body>
</html>
