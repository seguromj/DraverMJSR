
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Driver Dash | HUD Futurista</title>
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <style>
        :root {
            --neon-blue: #00f3ff;
            --neon-purple: #bc13fe;
            --neon-green: #39ff14;
            --dark-bg: #0a0b10;
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--dark-bg);
            background-image: radial-gradient(circle at top, #1a1b25 0%, #0a0b10 100%);
            color: #e0e0e0;
            margin: 0;
            padding: 15px;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            padding: 20px;
            border: 1px solid var(--neon-blue);
            border-radius: 20px;
            box-shadow: 0 0 15px var(--neon-blue);
            margin-bottom: 25px;
            background: var(--glass);
        }

        .header h2 {
            margin: 0;
            letter-spacing: 4px;
            color: var(--neon-blue);
            text-shadow: 0 0 10px var(--neon-blue);
        }

        .card {
            background: var(--glass);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .stat-box {
            background: rgba(0, 0, 0, 0.3);
            border-left: 3px solid var(--neon-purple);
            padding: 15px;
            border-radius: 8px;
        }

        .stat-label { font-size: 10px; color: #aaa; text-transform: uppercase; }
        .stat-value { font-size: 18px; font-weight: bold; display: block; margin-top: 5px; }

        .meta-container input {
            background: transparent;
            border: none;
            border-bottom: 2px solid var(--neon-blue);
            color: var(--neon-blue);
            font-size: 24px;
            text-align: center;
            width: 100%;
            margin-bottom: 10px;
        }

        .progress-bar-bg {
            background: #222;
            height: 10px;
            border-radius: 5px;
            overflow: hidden;
            box-shadow: inset 0 0 5px #000;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--neon-purple), var(--neon-blue));
            width: 0%;
            box-shadow: 0 0 15px var(--neon-blue);
            transition: 1s;
        }

        .gps-active {
            border: 1px solid var(--neon-green) !important;
            color: var(--neon-green) !important;
            box-shadow: 0 0-10px var(--neon-green);
        }

        input, select {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--glass-border);
            color: white;
            padding: 12px;
            border-radius: 8px;
            width: 100%;
            box-sizing: border-box;
            margin-bottom: 15px;
        }

        .btn {
            padding: 15px;
            border-radius: 10px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            text-transform: uppercase;
            transition: 0.3s;
            margin-bottom: 10px;
        }

        .btn-main { background: var(--neon-blue); color: #000; }
        .btn-gps { background: transparent; border: 1px solid var(--neon-purple); color: var(--neon-purple); }

        .history-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        .history-table th { text-align: left; color: var(--neon-blue); padding: 10px; }
        .history-table td { padding: 10px; border-bottom: 1px solid var(--glass-border); }

        .btn-excluir {
            background: none;
            border: none;
            color: #ff4444;
            cursor: pointer;
            font-size: 16px;
        }

        .neon-text-green { color: var(--neon-green); text-shadow: 0 0 5px var(--neon-green); }
        .neon-text-purple { color: var(--neon-purple); text-shadow: 0 0 5px var(--neon-purple); }
        .neon-text-blue { color: var(--neon-blue); text-shadow: 0 0 5px var(--neon-blue); }

    </style>
</head>
<body>

    <div class="header">
        <h2>PILOT HUD</h2>
        <div id="status-background" style="font-size: 10px; margin-top: 5px; color: #666;">MODO SEGUNDO PLANO: INATIVO</div>
    </div>

    <div class="card meta-container">
        <label class="stat-label">Meta de Faturamento</label>
        <input type="number" id="input-meta" oninput="atualizarDashboard()">
        <div class="progress-bar-bg">
            <div class="progress-bar-fill" id="barra-meta"></div>
        </div>
        <p id="txt-progresso" style="text-align:center; font-size:12px; margin-top:10px"></p>
    </div>

    <div class="card" style="text-align: center;">
        <label class="stat-label">Rastreador de KM Real (GPS)</label>
        <span class="stat-value neon-text-green" id="gps-km">0.00 KM</span>
        <button id="btn-gps" class="btn btn-gps" style="margin-top:10px" onclick="toggleGPS()">ATIVAR RASTREIO</button>
    </div>

    <div class="stats-grid">
        <div class="stat-box">
            <span class="stat-label">Bruto</span>
            <span class="stat-value neon-text-green" id="total-bruto">R$ 0,00</span>
        </div>
        <div class="stat-box">
            <span class="stat-label">KM Corridas (Manual)</span>
            <span class="stat-value neon-text-blue" id="km-acumulado">0.0 KM</span>
        </div>
        <div class="stat-box" style="grid-column: span 2; border-left-color: var(--neon-blue);">
            <span class="stat-label">Lucro L√≠quido Real</span>
            <span class="stat-value" id="total-liquido">R$ 0,00</span>
        </div>
    </div>

    <div class="card" style="margin-top: 20px;">
        <select id="tipo" onchange="toggleCampos()">
            <option value="corrida">Nova Corrida</option>
            <option value="despesa">Nova Despesa</option>
        </select>

        <div id="campos-corrida">
            <input type="number" id="valor" placeholder="Valor Ganho (R$)" step="0.01">
            <input type="number" id="km-corrida" placeholder="KM desta corrida (Manual)">
            <select id="plataforma">
                <option value="Uber">Uber</option>
                <option value="99">99 App</option>
                <option value="Particular">Particular</option>
            </select>
        </div>

        <div id="campos-despesa" style="display:none">
            <input type="number" id="valor-gasto" placeholder="Valor Gasto (R$)">
            <input type="text" id="desc-gasto" placeholder="Ex: Gasolina, Almo√ßo">
        </div>

        <button class="btn btn-main" onclick="salvarRegistro()">Computar Dados</button>
    </div>

    <div class="card">
        <span class="stat-label">Log de Atividades</span>
        <table class="history-table">
            <thead>
                <tr>
                    <th>Plat/Tipo</th>
                    <th>Valor</th>
                    <th>Info</th>
                    <th>A√ß√£o</th>
                </tr>
            </thead>
            <tbody id="lista-historico"></tbody>
        </table>
    </div>

    <button class="btn" style="background:transparent; color:#444; font-size:10px" onclick="limparTudo()">Resetar Banco de Dados</button>

    <script>
        let registros = JSON.parse(localStorage.getItem('fut_data')) || [];
        let metaDiaria = localStorage.getItem('fut_meta') || 300;
        let kmGPS = parseFloat(localStorage.getItem('fut_km_gps')) || 0;
        let proximoBip = Math.floor(kmGPS) + 1;
        
        let watchID = null;
        let lastCoords = null;
        let wakeLock = null;

        // Contexto de √°udio para o BIP
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function tocarBip() {
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(880, audioCtx.currentTime); 
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.1);
        }

        // FUN√á√ÉO PARA IMPEDIR A TELA DE APAGAR (WAKE LOCK)
        async function requestWakeLock() {
            try {
                if ('wakeLock' in navigator) {
                    wakeLock = await navigator.wakeLock.request('screen');
                    document.getElementById('status-background').innerText = "MODO SEGUNDO PLANO: ATIVO (TELA SEMPRE ACESA)";
                    document.getElementById('status-background').style.color = "var(--neon-green)";
                }
            } catch (err) {
                console.log(`${err.name}, ${err.message}`);
            }
        }

        document.getElementById('input-meta').value = metaDiaria;

        function toggleCampos() {
            const tipo = document.getElementById('tipo').value;
            document.getElementById('campos-corrida').style.display = tipo === 'corrida' ? 'block' : 'none';
            document.getElementById('campos-despesa').style.display = tipo === 'despesa' ? 'block' : 'none';
        }

        function toggleGPS() {
            const btn = document.getElementById('btn-gps');
            if (watchID === null) {
                if ("geolocation" in navigator) {
                    if (audioCtx.state === 'suspended') audioCtx.resume();
                    
                    requestWakeLock(); // Ativa o modo de tela sempre acesa
                    
                    btn.innerText = "RASTREIO ATIVO";
                    btn.classList.add('gps-active');
                    watchID = navigator.geolocation.watchPosition(pos => {
                        if (lastCoords) {
                            let d = calcularDistancia(
                                lastCoords.latitude, lastCoords.longitude,
                                pos.coords.latitude, pos.coords.longitude
                            );
                            if (d > 0.005) { 
                                kmGPS += d;
                                localStorage.setItem('fut_km_gps', kmGPS);
                                document.getElementById('gps-km').innerText = kmGPS.toFixed(2) + " KM";
                                if (kmGPS >= proximoBip) {
                                    tocarBip();
                                    proximoBip = Math.floor(kmGPS) + 1;
                                }
                            }
                        }
                        lastCoords = pos.coords;
                    }, err => console.log(err), { enableHighAccuracy: true });
                }
            } else {
                navigator.geolocation.clearWatch(watchID);
                watchID = null;
                if (wakeLock !== null) {
                    wakeLock.release();
                    wakeLock = null;
                }
                document.getElementById('status-background').innerText = "MODO SEGUNDO PLANO: INATIVO";
                document.getElementById('status-background').style.color = "#666";
                btn.innerText = "ATIVAR RASTREIO";
                btn.classList.remove('gps-active');
                lastCoords = null;
            }
        }

        function calcularDistancia(lat1, lon1, lat2, lon2) {
            const R = 6371;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        function salvarRegistro() {
            const tipo = document.getElementById('tipo').value;
            let entry;

            if(tipo === 'corrida') {
                entry = {
                    id: Date.now(),
                    tipo: 'corrida',
                    valor: parseFloat(document.getElementById('valor').value) || 0,
                    km: parseFloat(document.getElementById('km-corrida').value) || 0,
                    plat: document.getElementById('plataforma').value
                };
            } else {
                entry = {
                    id: Date.now(),
                    tipo: 'despesa',
                    valor: parseFloat(document.getElementById('valor-gasto').value) || 0,
                    desc: document.getElementById('desc-gasto').value || 'Gasto'
                };
            }

            if(entry.valor > 0) {
                registros.push(entry);
                localStorage.setItem('fut_data', JSON.stringify(registros));
                atualizarDashboard();
                document.getElementById('valor').value = '';
                document.getElementById('km-corrida').value = '';
                document.getElementById('valor-gasto').value = '';
                document.getElementById('desc-gasto').value = '';
            }
        }

        function excluirRegistro(id) {
            if(confirm("Excluir este item?")) {
                registros = registros.filter(r => r.id !== id);
                localStorage.setItem('fut_data', JSON.stringify(registros));
                atualizarDashboard();
            }
        }

        function atualizarDashboard() {
            metaDiaria = parseFloat(document.getElementById('input-meta').value) || 0;
            localStorage.setItem('fut_meta', metaDiaria);

            let bruto = 0, gastos = 0, kmSoma = 0;
            const lista = document.getElementById('lista-historico');
            lista.innerHTML = '';

            [...registros].reverse().forEach(r => {
                if(r.tipo === 'corrida') {
                    bruto += r.valor;
                    kmSoma += r.km;
                    lista.innerHTML += `<tr><td>${r.plat}</td><td class="neon-text-green">R$ ${r.valor.toFixed(2)}</td><td>${r.km}km</td><td><button class="btn-excluir" onclick="excluirRegistro(${r.id})">üóëÔ∏è</button></td></tr>`;
                } else {
                    gastos += r.valor;
                    lista.innerHTML += `<tr><td>GASTO</td><td class="neon-text-purple">R$ ${r.valor.toFixed(2)}</td><td>${r.desc}</td><td><button class="btn-excluir" onclick="excluirRegistro(${r.id})">üóëÔ∏è</button></td></tr>`;
                }
            });

            document.getElementById('total-bruto').innerText = "R$ " + bruto.toFixed(2);
            document.getElementById('total-liquido').innerText = "R$ " + (bruto - gastos).toFixed(2);
            document.getElementById('km-acumulado').innerText = kmSoma.toFixed(1) + " KM";
            document.getElementById('gps-km').innerText = kmGPS.toFixed(2) + " KM";

            let perc = metaDiaria > 0 ? (bruto / metaDiaria) * 100 : 0;
            document.getElementById('barra-meta').style.width = Math.min(perc, 100) + "%";
            document.getElementById('txt-progresso').innerText = `STATUS: ${perc.toFixed(1)}% DA META`;
        }

        function limparTudo() {
            if(confirm("Reiniciar todo o sistema?")) {
                localStorage.clear();
                location.reload();
            }
        }

        atualizarDashboard();
    </script>
</body>
</html>
